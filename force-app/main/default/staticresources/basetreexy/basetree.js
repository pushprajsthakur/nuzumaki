function recursiveFind(a,d,b){if(b(a))return a;var e=d(a),c=e.find(b);if(!c){for(var f of e)if(c=recursiveFind(f,d,b))break}return c}function recursiveGet(f,b){var a=[],c=b(f);if(c)for(var d of c){a.push(d);var e=recursiveGet(d,b);e&&(a=[...a,...e])}return a}class BaseTree extends EventEmitter{constructor(b){super(),b=b||{};var a={...BaseTree.defaults,...b};this._root=null,this._svg=null,this._panningContainer=null,this._view=null,this._treeGenerator=null,this._linkPathGenerator=null,this._visibleNodes=null,this._links=null,this._zoomListener=null,this.setTheme(a.theme),this.setOrientation(a.orientation),this.setData(a.data),this.setElement(a.element),this.setWidthWithoutMargins(a.widthWithoutMargins),this.setHeightWithoutMargins(a.heightWithoutMargins),this.setMargins(a.margins),this.setDuration(a.duration),this.setAllowPan(a.allowPan),this.setAllowZoom(a.allowZoom),this.setAllowFocus(a.allowFocus),this.setAllowNodeCentering(a.allowNodeCentering),this.setMinScale(a.minScale),this.setMaxScale(a.maxScale),this.setIsFlatData(a.isFlatData),this.setNodeDepthMultiplier(a.nodeDepthMultiplier),this.loadOnDemandSettings=new LoadOnDemandSettings(this,a.loadOnDemandSettings),this.nodeSettings=new NodeSettings(this,a.nodeSettings),this._getId=a.getId,this._getChildren=a.getChildren,this._getParentId=a.getParentId}_nodeEnter(a,b){throw"The function _nodeEnter must be implemented"}_nodeUpdate(a,b,c){throw"The function _nodeUpdate must be implemented"}_nodeExit(a,b,c){throw"The function _nodeExit must be implemented"}_getLinkPathGenerator(){throw"The function _getLinkPathGenerator must be implemented"}_linkEnter(a,b,c,d){throw"The function _linkEnter must be implemented"}_linkUpdate(a,b,c,d,e){throw"The function _linkUpdate must be implemented"}_linkExit(a,b,c,d,e){throw"The function _linkExit must be implemented"}_getNodeSize(){throw"The function _getNodeSize must be implemented"}focusToNode(c){this.removeSelection(this.getRoot());var b=c;"object"!=typeof b&&null!==b&&(b=this.getNode(b));var a=null;for(a=b.parent;a;)a._children&&this.expand(a),a=a.parent;if(this.getAllowFocus()){for(a=b.parent;a;)this.hideSiblings(a),a=a.parent;this.updateTreeWithFocusOnNode(b),b.selected=!0}return this.update(this.getRoot()),this.centerNode(b),this}getIsFlatData(){return this._isFlatData}setIsFlatData(a){return this._isFlatData=a,this}regenerateNodeData(){if(this.getIsFlatData()){if(!this._getParentId)throw"If you are providing flat structured data, then you must set the getParentId accessor property.";var a=d3.stratify().id((a,b,c)=>this.getId.call(this,a)).parentId((a,b,c)=>this.getParentId.call(this,a));this._root=a(this.getData())}else{if(!this._getChildren)throw"If you are providing hierarchical structured data, then you must set the getChildren accessor property.";this._root=d3.hierarchy(this.getData(),a=>this.getChildren.call(this,a))}return this}getTheme(){return this._theme}setTheme(a){return this._theme=a,this}getOrientation(){return this._orientation}setOrientation(a){return this._orientation=a,this}getData(){return this._data}setData(a){return this._data=a,this}getNodeDepthMultiplier(){return this._nodeDepthMultiplier}setNodeDepthMultiplier(a){return this._nodeDepthMultiplier=a,this}getDuration(){return this._duration}setDuration(a){return this._duration=a,this}getAllowPan(){return this._allowPan}setAllowPan(a){return this._allowPan=a,this}getAllowZoom(){return this._allowZoom}setAllowZoom(a){return this._allowZoom=a,this}getAllowFocus(){return this._allowFocus}setAllowFocus(a){return this._allowFocus=a,this}getAllowNodeCentering(){return this._allowNodeCentering}setAllowNodeCentering(a){return this._allowNodeCentering=a,this}getMinScale(){return this._minScale}setMinScale(a){return this._minScale=a,this}getMaxScale(){return this._maxScale}setMaxScale(a){return this._maxScale=a,this}getLoadOnDemandSettings(){return this.loadOnDemandSettings}getNodeSettings(){return this.nodeSettings}getElement(){return this._element}setElement(a){return this._element=a,this}getRoot(){return this._root}getSvg(){return this._svg}getView(){return this._view}getPanningContainer(){return this._panningContainer}getTreeGenerator(){return this._treeGenerator}getNode(b){var a=b;return"object"==typeof a&&null!==a&&(a=this.getId(a)),recursiveFind(this.getRoot(),a=>a._children?a._children:[],b=>this.getId(b.data)==a)}getDataItem(a){return this.getNode(a).data}getNodes(){return this._nodes}getVisibleNodes(){return this._visibleNodes}getLinks(){return this._links}getZoomListener(){return this._zoomListener}getId(a){return this._getId(a)}getChildren(a){return this._getChildren(a)}getParentId(a){return this._getParentId(a)}setIdAccessor(a){return this._getId=a,this}setChildrenAccessor(a){return this._getChildren=a,this}setParentIdAccessor(a){return this._getParentId=a,this}getWidth(){return this.getWidthWithoutMargins()-this.getMargins().left-this.getMargins().right}getHeight(){return this.getHeightWithoutMargins()-this.getMargins().top-this.getMargins().bottom}setMargins(a){return this._margins=a,this}getMargins(){return this._margins}setWidthWithoutMargins(a){return this._widthWithoutMargin=a,this}getWidthWithoutMargins(){return this._widthWithoutMargin}setHeightWithoutMargins(a){return this._heightWithoutMargin=a,this}getHeightWithoutMargins(){return this._heightWithoutMargin}updateDimensions(){this.getSvg().attr("viewBox","0 0 "+this.getWidthWithoutMargins()+" "+this.getHeightWithoutMargins());var d,e,a=this.getMargins(),b=!1,c=this.nodeSettings.getSizingMode();return"string"==typeof c&&(c=c.trim().toLowerCase()),"nodesize"===c?(this.getTreeGenerator().nodeSize(this._getNodeSize()),!1===this.getAllowFocus()&&(b=!0)):this.getTreeGenerator().size([this.getHeight(),this.getWidth()]),!1===b?this.getView().attr("transform","translate("+a.left+","+a.top+")"):this.getView().attr("transform","translate("+a.left+", "+(this.getHeight()/2+a.top)+")"),"topToBottom"===this.getOrientation()?(d=!1===b?this.getWidth()/2:0,e=this.getHeight()/4):(d=!1===b?this.getHeight()/2:0,e=0),this.getRoot().x0=d,this.getRoot().y0=e,this.getZoomListener()&&this.getZoomListener().extent([[0,0],[this.getWidthWithoutMargins(),this.getHeightWithoutMargins()]]),this}validateSettings(){if(!this.getElement())throw"Need to pass in an element as part of the options";if(!this.getData())throw"Need to pass in data as part of the options";if(!this._getId)throw"Need to define the getId function as part of the options";return this.loadOnDemandSettings.validateSettings(),this}initialize(){for(this.validateSettings(),this.regenerateNodeData();this.getElement().firstChild;)this.getElement().removeChild(this.getElement().firstChild);return this._svg=d3.select(this.getElement()).append("svg").classed("mitch-d3-tree",!0).classed(this.getTheme(),!0).attr("preserveAspectRatio","xMidYMid meet").style("width","100%").style("height","100%"),this._view=this.getSvg().append("g").classed("view",!0),this._treeGenerator=d3.tree(),this._panningContainer=this.getView().append("g").classed("panningContainer",!0),this._zoomListener=d3.zoom().scaleExtent([this.getMinScale(),this.getMaxScale()]).on("zoom",()=>{var a=d3.event.transform;this.getPanningContainer().attr("transform",a)}),this.getSvg().call(this.getZoomListener()),!1===this.getAllowPan()&&this.getSvg().on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),!1===this.getAllowZoom()&&this.getSvg().on("dblclick.zoom",null).on("wheel.zoom",null),this.updateDimensions(),this._populateUnderlyingChildren(this.getRoot()),this.getRoot().children&&this.getRoot().children.forEach(this.collapseRecursively),this.removeSelection(this.getRoot()),this.update(this.getRoot()),this.centerNode(this.getRoot()),this}expand(a){return a.children=a._children,this}expandRecursively(a){return!function b(a){a.children&&(a.children.forEach(b),a.children=a._children)}(a),this}collapse(a){return a.children=null,this}collapseRecursively(a){return!function b(a){a.children&&(a.children.forEach(b),a.children=null)}(a),this}_populateUnderlyingChildren(a){return!function b(a){a.children&&(a._children=a.children,a._children.forEach(b))}(a),this}removeSelection(a){return!function b(a){a.selected=!1,a.children&&a.children.forEach(b)}(a),this}centerNode(b){var c,d,e,f,a=d3.zoomTransform(this.getSvg().node()).k;return"toptobottom"===this.getOrientation().toLowerCase()?(c=-b.x0,d=-b.y0,e=c*a+this.getWidth()/2,f=d*a+this.getHeight()/2):(c=-b.y0,d=-b.x0,e=c*a+this.getWidth()/4,f=d*a+this.getHeight()/2),this.getSvg().transition().duration(this.getDuration()).call(this.getZoomListener().transform,d3.zoomIdentity.translate(e,f).scale(a)),this}_onNodeClick(a,c,d){var b={type:this.getAllowFocus()?"focus":a.children?"collapse":"expand",continue:!0,nodeDataItem:a,nodeDataItemIndex:c,nodeDataItems:d,preventDefault:function(){b.continue=!1}};return this.emit("nodeClick",b),!1!==b.continue&&(this.getAllowFocus()?this.nodeFocus.call(this,a):this.nodeToggle.call(this,a),!0)}_createNode(b,c){var a=d3.hierarchy(c);return a.depth=b.depth+1,a.height=b.height-1,a.parent=b,a.id=this.getId.call(this,c),a}_addUnderlyingChildNode(a,c){var b=this._createNode(a,c);return a._children.push(b),b}_processLoadedDataForNodeFocus(a,c){a._children=[],c.forEach(b=>this._addUnderlyingChildNode(a,b)),this._populateUnderlyingChildren(a),this.updateTreeWithFocusOnNode(a);var b=a.selected;return this.removeSelection(this.getRoot()),a.selected=!0,this.update(a),!0===this.getAllowNodeCentering()&&(!1===b|| void 0===b)&&this.centerNode(a),this}nodeFocus(a){if(!a.children&&!a._children&&this.loadOnDemandSettings.isEnabled()&&this.loadOnDemandSettings.hasChildren(a.data)){var c=b=>this._processLoadedDataForNodeFocus(a,b);this.loadOnDemandSettings.loadChildren(a.data,c)}else{this.updateTreeWithFocusOnNode(a);var b=a.selected;this.removeSelection(this.getRoot()),a.selected=!0,this.update(a),!0===this.getAllowNodeCentering()&&(!1===b|| void 0===b)&&this.centerNode(a)}return this}_processLoadedDataForNodeToggle(a,b){return a._children=[],b.forEach(b=>this._addUnderlyingChildNode(a,b)),this.expand(a),this.update(a),this}nodeToggle(a){if(this.removeSelection(this.getRoot()),a.selected=!0,!a.children&&!a._children&&this.loadOnDemandSettings.isEnabled()&&this.loadOnDemandSettings.hasChildren(a.data)){var b=b=>{this._processLoadedDataForNodeToggle(a,b),!0===this.getAllowNodeCentering()&&this.centerNode(a)};this.loadOnDemandSettings.loadChildren(a.data,b)}else a.children?this.collapse(a):this.expand(a),this.update(a),!0===this.getAllowNodeCentering()&&this.centerNode(a);return this}hideSiblings(b){var a=b.parent;if(a){var c=this.getId(b.data);a.children.filter(a=>this.getId(a.data)!=c).forEach(this.collapseRecursively),a.children=[],a.children.push(b)}return this}updateTreeWithFocusOnNode(a){return!a.children&&a._children?(this.hideSiblings(a),this.expand(a),a.children.forEach(this.collapseRecursively)):a.children&& !1== !a.children.some((a,b,c)=>a.children)&&(this.collapseRecursively(a),this.expand(a)),this}_updateNodes(g,a){a.forEach(a=>a.y=a.depth*this.getNodeDepthMultiplier());var a=this.getPanningContainer().selectAll("g.node").data(a,a=>this.getId.call(this,a.data)),c=a.enter().append("g").classed("node",!0).attr("transform",(a,b,c)=>"toptobottom"===this.getOrientation().toLowerCase()?"translate("+g.x0+","+g.y0+")":"translate("+g.y0+","+g.x0+")").on("click",(a,b,c)=>this._onNodeClick.call(this,a,b,c));this._nodeEnter(c,a);var b=c.merge(a),e=b.transition().duration(this.getDuration());b.classed("collapsed",(a,b,c)=>!a.children&&!!a._children|| !!(this.loadOnDemandSettings.isEnabled()&&this.loadOnDemandSettings.hasChildren(a.data))&&!a.children&&!a._children).classed("expanded",(a,b,c)=>a.children).classed("childless",(a,b,c)=>!a.children&&!a._children).classed("selected",(a,b,c)=>a.selected),this._nodeUpdate(b,e,a);var d=a.exit(),f=d.transition().duration(this.getDuration());return this._nodeExit(d,f,a),this}_updateLinks(b,g){var c=this._getLinkPathGenerator(),a=this.getPanningContainer().selectAll("path.link").data(g,a=>this.getId.call(this,a.data)),d=a.enter().insert("path","g").classed("link",!0);this._linkEnter(b,d,a,c);var e=d.merge(a),h=e.transition().duration(this.getDuration());this._linkUpdate(b,e,h,a,c);var f=a.exit(),i=f.transition().duration(this.getDuration());return this._linkExit(b,f,i,a,c),this.getVisibleNodes().forEach(a=>{a.x0=a.x,a.y0=a.y}),this}update(a){var b=this.getTreeGenerator()(this.getRoot());return this._visibleNodes=b.descendants(),this._nodes=[this.getRoot(),...recursiveGet(this.getRoot(),a=>a._children)],this._links=b.descendants().slice(1),this._updateNodes(a,this.getVisibleNodes())._updateLinks(a,this.getLinks()),this}}BaseTree.defaults={theme:"default",orientation:"leftToRight",allowPan:!0,allowZoom:!0,allowFocus:!0,allowNodeCentering:!0,minScale:1,maxScale:2,nodeDepthMultiplier:300,isFlatData:!1,getId:null,getParentId:null,getChildren:null,widthWithoutMargins:960,heightWithoutMargins:800,margins:{top:40,right:20,bottom:40,left:100},duration:750,loadOnDemandSettings:{},nodeSettings:{}}